---
layout: post
title: JPA 다양한 연관관계 매핑
subtitle: 엔티티는 대부분 다른 엔티티와 연관관계가 있으며 이를 JPA에서 어떻게 매핑하는지에 대해 알아보자.
category: jpa
---


### 연관 관계의 정의

방향 : 단방향(한쪽만 참조), 양방향(양쪽 모두 참조)

다중성 : 일대일(1:1), 다대일(N:1), 일대다(1:N), 다대다(N:N)

연관 관계의 주인 : 객체를 양방향 연관관계로 만들면 연관관계의 주인을 정해줘야합니다.

### 객체와 테이블의 연관관계

데이터베이스는 외래키를 사용한 조인으로 양방향 관계가 가능하지만

객체는 참조로 연관관계를 맺고 참조용 필드가 있는 객체만 참조할수 있기때문에  단방향 관계입니다. 그러기 때문에 양방향 객체 참조를 할려면 단방향 관계 두개를 사용하여야 합니다.

### 연관관계의 주인

엔티티를 양방향으로 설정할시 객체의 참조는 둘인데 외래키는 하나입니다. 따라서 둘사이의 차이가 발생하는데요 이러한 차이로 JPA에서는 두 객체의 연관관계 중 하나를 정하여 외래키를 관리하는데 이것을 연관관계의 주인이라고 합니다.

### 다양한 연관관계 매핑

연관관계를 매핑하기 위하여 사용되는 어노테이션이 있습니다. 다음과 같습니다.

- @ManyToOne : 다대일(N:1)관계 매핑 정보입니다.
    - 속성
        - optional : 기본값이 true이며 false로 설정할시 연관된 엔티티가 항상 있어야합니다.
        - fetch : 글로벌 페치 전략을 설정합니다.
        - cascade : 영속성 전이 기능을 사용합니다.
        - targetEntity : 연관된 엔티티의 타입 정보를 설정합니다.

- @JoinColumn(name = “매핑할 외래키”) : 조인컬럼은 외래키를 매핑할때 사용하며 name 에는 키 이름을 지정합니다.
    - 속성
        - name : 매핑할 외래키 이름
        - referencedColumnName : 외래키가 참조하는 대상 테이블의 컬럼명
        - foreignKey(DDL) : 외래키 제약조건을 직접 지정할 수 있습니다.(테이블을 생성할 때만 사용합니다.)

- 아래는 @ManytoOne (단방향) 예시입니다.

```java

public class Member{

	@Id
	@GeneratedValue
	@Column(name = "MEMBER_ID")
	private Long id;

	private String username;

	// 연관 관계 매핑
	@ManyToOne
	@JoinColumn(name = "TEAM_ID")
	private Team team;

	//getter,setter
}

```



```java
@Entity
public class Team{

		@Id
		@GeneratedValue
		@Column(name = "TEAM_ID")
		private Long id;

		private String name;


		//getter, setter
}
```

- 아래는 @ManytoOne(양방향) 예시입니다.

```java
@Entity
public class Team{
		@Id
		@GeneratedValue
		@Column(name = "TEAM_ID")
		private Long id;

		private String name;

		@OnetoMany(mappedBy = "team")
		private List<Member> members = new ArrayList<Member>();

		//getter, setter
}
```

- 다대일(N:1) 관계의 반대방향은 일대다(1:N)입니다.
- 양방향 관계에서 대부분 다(N)쪽이 외래키를 가지고 있습니다.
- 양방향 관계에서 외래키를 가지고있는 쪽인 연관 관계의 주인입니다.

- @OnetoMany : 일대다(1:N)관계 매핑 정보입니다.
    - 속성
        - mappedBy = 연관관계의 주인 필드를 선택한다
        - fetch : 글로벌 페치 전략을 설정합니다.
        - cascade : 영속성 전이 기능을 사용합니다.
        - targetEntity : 연관된 엔티티의 타입 정보를 설정합니다.

    ```java
    @Entity
    public class Team{

    		@Id
    		@Column(name = "TEAM_ID")
    		private Long id;

    		private String name;

    		// 추가
    		@OnetoMany(mappedBy = "team")
    		private List<Member> members = new ArrayList<Member>();

    		//getter, setter
    }
    ```

- 다대일, 일대다 관계에서는 항상 다쪽이 외래키를 가집니다.
-

- @OnetoOne :  일대일(1:1)관계 매핑 정보입니다.
